<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html{
            scroll-behavior: smooth;
            font-family: "Open Sans", sans-serif;
            font-size: 1em;
        }
        ul, ol{
            list-style: none;
        } 
        a{
            text-decoration: none;
            color: #000;
        }
        #GNB{
            position: fixed;
            right: 50px;
            top: 50%;
            margin-top: -88px;
            width: 16px;
            height: 176px;
        }
        #GNB li{
            margin-top: 16px;
            width: 16px;
            height: 16px;
            background-color: transparent;
            border: 2px solid #000;
            border-radius: 8px;
        }
        #GNB li:first-child{
            margin-top: 0;
        }
        #GNB li.active{
            background-color: #000;
        }
        #GNB li a{
            display: block;
            width: 16px;
            height: 16px;
            text-indent: -9999px;
        }
        section{
            padding: 20px;
        } 
    </style>
    <script>
        window.addEventListener('load', function(){
            var h;  // 현재 윈도우의 높이
            var n = 0;  // 메뉴 번호와 관련된 변수
            var targety = 0;    // 상단 목표 위치에 관련된 변수
            var offsety = 0;    // 상단 위치에 관련된 변수
            var timer = 0;      // 현재 움직임에 관련된 타이머 변수
            var moving = false; // 현재 움직임 유무에 관련된 변수

            var container = document.getElementsByClassName('container')[0];
            var gnb = document.getElementById('GNB');
            var menuList = gnb.children[0].children;    // li 태그들을 list 형식으로    .GNB > ul > li
            var pageList = [];

            // 각 컨텐츠들을 배열변수 pageList에 각각 입력
            for(var i = 0; i < container.children.length; i++){
                if(container.children[i].tagName == "SECTION"){
                    pageList.push(container.children[i]);

                }
            }

            // SECTION의 높이를 설정
            function init(){
                h = window.innerHeight;
                targety = n * h;       // n = section의 갯수, 위에 기본 0으로 선언
                menuList[n].classList.add('active');

                for(var i = 0 ; i < pageList.length; i++){
                    pageList[i].style.height = h + 'px';
                }
            }
            init();     // 화면이 load 됨과 동시에 실행될 것이다

            // 화면의 크기에 따라서 SECTION의 높이를 설정
            window.addEventListener('resize', init);
// -------------------------------------------------------------------- 위에서 여기까지가 기본설정이다
            // 스크롤 이벤트 적용하는 함수
            document.addEventListener('scroll', function(){

                timer = setInterval(function(){
                    clearInterval(timer);
                    offsety = window.pageYOffset;
                    // console.log(offsety);
                    
                    if(offsety < pageList[1].offsetTop){
                        n = 0;
                    }else if(offsety < pageList[2].offsetTop){
                        n = 1;
                    }else if(offsety < pageList[3].offsetTop){
                        n = 2;
                    }else if(offsety < pageList[4].offsetTop){
                        n = 3;
                    }else if(offsety < pageList[5].offsetTop){
                        n = 4;
                    }else{
                        n = 5;
                    }

                    for(var i = 0 ; i < menuList.length; i++){
                        if(i == n){
                            menuList[i].classList.add('active');
                        }else{
                            menuList[i].classList.remove('active');
                        }
                    }
                },10);     // setInterval 함수에는 시간을 지정해줄 수 있다 
                
                // 메뉴리스트에 클릭했을 때 해당 콘텐츠로 이동할수 있는 값을 계산하는 함수
                for(var i = 0; i < menuList.length; i++){
                    
                    menuList[i].index = i;  // menuList의 인덱스값을 i에 담는다
                    menuList[i].addEventListener('click', function(e){
                        e.preventDefault();
                        if(moving) return; // 초기값 moving = false;

                        offsety = window.pageYOffset;
                        // n = e.window.innerHeight;   // 클릭한 인덱스의 창의 보이는 창의 높이?
                        n = e.currentTarget.index;
                        h = window.innerHeight;
                        targety = n*h; // h = 1000 이면 n의 값에따라 스크롤이 이동하도록
                        
                        moveCategory(offsety, targety); // 얘가 이동하는 함수가 됨
                    });
                }

                // 이동하는 함수
                function moveCategory(current, target){

                    moving = true;
                    
                    var timer = setInterval(function(){

                        // 첫번째 if문은 화면을 내려가도록 할지 올라가도록 할지 정하는 거
                        if(target > current){  // 스크롤이 아래로 이동할 때
                            if(Math.abs(target - current) > 8){    // 스크롤이 아래로 가는 애니메이션의 진행여부를 결정하는 제어문
                                current += 8;
                            }else{
                                current = target;  // 현재값에 목표값을 대입한다는 것은 이동하지 않겠다는 뜻
                                moving = false; 
                                clearInterval(timer);

                                // 현재 스크롤의 값을 타겟의 스크롤값을 비교해서 해당하는 대상에 클래스 적용
                                for(var i = 0 ; i < menuList.length ; i++){
                                    if(i == n){
                                        menuList[i].classList.add("active");
                                    }else{
                                        menuList[i].classList.remove("active");
                                    }
                                }
                            }
                        }else{  // 스크롤이 위로 이동할 때
                            if(Math.abs(target - current) > 8){    // 스크롤이 아래로 가는 애니메이션의 진행여부를 결정하는 제어문
                                current -= 8;
                            }else{
                                current = target;  // 현재값에 목표값을 대입한다는 것은 이동하지 않겠다는 뜻
                                moving = false; 
                                clearInterval(timer);

                                // 현재 스크롤의 값을 타겟의 스크롤값을 비교해서 해당하는 대상에 클래스 적용
                                for(var i = 0 ; i < menuList.length ; i++){
                                    if(i == n){
                                        menuList[i].classList.add("active");
                                    }else{
                                        menuList[i].classList.remove("active");
                                    }
                                }
                            }
                        }

                        window.scrollTo({   // 화면의 스크롤을 어디로 보낼 것인가
                            top: current,
                            behavior: "smooth"
                        });

                    }, 1);
                }

            });
        });
    </script>
</head>
<body>
    <div class="container">
        <header id="GNB">
            <ul>
                <li><a href="">menu1</a></li>   <!-- 얘들이 menuList이다 -->
                <li><a href="">menu2</a></li>
                <li><a href="">menu3</a></li>
                <li><a href="">menu4</a></li>
                <li><a href="">menu5</a></li>
                <li><a href="">menu6</a></li>
            </ul>
        </header>
        <section id="index" class="page">index</section>
        <section id="page1" class="page">page1</section>
        <section id="page2" class="page">page2</section>
        <section id="page3" class="page">page3</section>
        <section id="page4" class="page">page4</section>
        <section id="page5" class="page">page5</section>
    </div>
</body>
</html>